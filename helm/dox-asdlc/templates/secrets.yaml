{{/*
Secrets for the dox-asdlc system.
WARNING: Default values are placeholders only. Override in production.
*/}}

{{- if .Values.secrets.redis.create }}
{{- if not .Values.secrets.redis.password }}
{{- fail "SECURITY ERROR: secrets.redis.password is required. Set with --set secrets.redis.password=<strong-password>" }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dox-asdlc.redisSecretName" . }}
  namespace: {{ include "dox-asdlc.namespace" . }}
  labels:
    {{- include "dox-asdlc.labels" . | nindent 4 }}
type: Opaque
data:
  redis-password: {{ .Values.secrets.redis.password | b64enc | quote }}
{{- end }}

{{- if .Values.secrets.git.create }}
{{- if not .Values.secrets.git.username }}
{{- fail "SECURITY ERROR: secrets.git.username is required. Set with --set secrets.git.username=<username>" }}
{{- end }}
{{- if not .Values.secrets.git.token }}
{{- fail "SECURITY ERROR: secrets.git.token is required. Set with --set secrets.git.token=<token>" }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dox-asdlc.gitSecretName" . }}
  namespace: {{ include "dox-asdlc.namespace" . }}
  labels:
    {{- include "dox-asdlc.labels" . | nindent 4 }}
type: Opaque
data:
  username: {{ .Values.secrets.git.username | b64enc | quote }}
  token: {{ .Values.secrets.git.token | b64enc | quote }}
{{- end }}

{{- if .Values.secrets.apiKeys.create }}
{{- if not .Values.secrets.apiKeys.claudeApiKey }}
{{- fail "SECURITY ERROR: secrets.apiKeys.claudeApiKey is required. Set with --set secrets.apiKeys.claudeApiKey=<api-key>" }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dox-asdlc.apiKeysSecretName" . }}
  namespace: {{ include "dox-asdlc.namespace" . }}
  labels:
    {{- include "dox-asdlc.labels" . | nindent 4 }}
type: Opaque
data:
  claude-api-key: {{ .Values.secrets.apiKeys.claudeApiKey | b64enc | quote }}
{{- end }}
